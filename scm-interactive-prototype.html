<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise SCM System - Interactive Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Scrollbar for a cleaner enterprise feel */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Chart Container Strict Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Invoice Modal Print Styling */
        @media print {
            body * {
                visibility: hidden;
            }
            #invoice-modal, #invoice-modal * {
                visibility: visible;
            }
            #invoice-modal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: white;
            }
        }
    </style>
    <!-- Chosen Palette: Warm Enterprise Neutrals -->
    <!-- Application Structure Plan: A Dashboard-style SPA with sidebar navigation. 
         1. 'Dashboard': The core view simulating the Java Controller's main page. Features the Predictive Alert Logic interactively.
         2. 'Shipments': Simulates the Shipment History and PDF generation (via HTML modal).
         3. 'Architecture': Interactive visual breakdown of the MVC structure and Tech Stack described in the README.
         The structure was chosen to directly mirror the user experience described in the documentation, effectively "bringing the README to life". -->
    <!-- Visualization & Content Choices: 
         - Stock Levels (Bar Chart): To visualize the "Predictive Twist". Goal: Compare Stock vs Threshold.
         - Inventory Health (Doughnut Chart): To show summary stats. Goal: Inform.
         - Architecture Diagram (HTML/CSS Flow): To visualize the MVC layers. Goal: Organize/Educate.
         - Interactive Tables: To mimic the Thymeleaf tables. Goal: Organize.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-slate-900 text-white flex-shrink-0 hidden md:flex flex-col shadow-xl z-20">
        <div class="p-6 border-b border-slate-700">
            <h1 class="text-xl font-bold tracking-tight text-emerald-400">SCM System</h1>
            <p class="text-xs text-slate-400 mt-1">Enterprise Edition</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li>
                    <button onclick="navTo('dashboard')" id="nav-dashboard" class="nav-item w-full text-left px-6 py-3 hover:bg-slate-800 transition-colors flex items-center border-l-4 border-transparent text-emerald-400 bg-slate-800 border-emerald-400">
                        <span>üìä Dashboard & Alerts</span>
                    </button>
                </li>
                <li>
                    <button onclick="navTo('shipments')" id="nav-shipments" class="nav-item w-full text-left px-6 py-3 hover:bg-slate-800 transition-colors flex items-center border-l-4 border-transparent">
                        <span>üöö Shipment History</span>
                    </button>
                </li>
                <li>
                    <button onclick="navTo('architecture')" id="nav-architecture" class="nav-item w-full text-left px-6 py-3 hover:bg-slate-800 transition-colors flex items-center border-l-4 border-transparent">
                        <span>üèó Architecture</span>
                    </button>
                </li>
            </ul>
        </nav>
        <div class="p-4 border-t border-slate-700 bg-slate-800">
            <div class="text-xs text-slate-400">
                <p>Status: <span class="text-emerald-400">Online</span></p>
                <p class="mt-1">Backend: Java 21 / Spring</p>
            </div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed top-0 w-full bg-slate-900 text-white z-50 flex justify-between items-center p-4 shadow-md">
        <span class="font-bold text-emerald-400">SCM System</span>
        <button onclick="toggleMobileMenu()" class="text-slate-200 hover:text-white">Menu</button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="hidden fixed inset-0 bg-slate-900 z-40 pt-16 px-6">
        <button onclick="navTo('dashboard'); toggleMobileMenu()" class="block w-full text-left py-4 text-emerald-400 border-b border-slate-700">Dashboard</button>
        <button onclick="navTo('shipments'); toggleMobileMenu()" class="block w-full text-left py-4 text-white border-b border-slate-700">Shipments</button>
        <button onclick="navTo('architecture'); toggleMobileMenu()" class="block w-full text-left py-4 text-white border-b border-slate-700">Architecture</button>
    </div>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 pt-20 md:pt-8 bg-slate-50 relative">

        <!-- VIEW: DASHBOARD -->
        <section id="view-dashboard" class="space-y-6 max-w-7xl mx-auto">
            <!-- Intro Block -->
            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Inventory Overview</h2>
                <p class="text-slate-600">
                    Welcome to the SCM Dashboard. This view demonstrates the <strong class="text-indigo-600">Predictive Analytics Engine</strong> described in the project documentation. 
                    Unlike standard systems, observe how alerts are triggered based on <code>reorderThreshold</code> logic, not just zero stock.
                    Try editing the values in the table below to see the logic in real-time.
                </p>
            </div>

            <!-- Dynamic Alert Box (The Twist) -->
            <div id="alert-container" class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded-md shadow-sm transition-all duration-300">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <span class="text-2xl">üö®</span>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-lg leading-6 font-medium text-red-800">Predictive Stock Alerts</h3>
                        <div class="mt-2 text-sm text-red-700">
                            <ul id="alert-list" class="list-disc pl-5 space-y-1">
                                <!-- Dynamic JS content -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Stock vs Threshold Chart -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Stock Level vs. Reorder Point</h3>
                    <div class="chart-container">
                        <canvas id="stockChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-slate-500 mt-2">Visualizing the safety buffer for each product.</p>
                </div>
                
                <!-- Inventory Health Donut -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Inventory Health Distribution</h3>
                    <div class="chart-container">
                        <canvas id="healthChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-slate-500 mt-2">Proportion of Healthy vs. At-Risk items.</p>
                </div>
            </div>

            <!-- Inventory Table with Interactive Editing -->
            <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                    <h3 class="text-lg font-semibold text-slate-800">Current Inventory</h3>
                    <span class="text-xs font-mono bg-slate-200 px-2 py-1 rounded text-slate-600">Simulating: ProductRepository.findAll()</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Product Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Price</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Current Stock (Editable)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Threshold (Editable)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body" class="bg-white divide-y divide-slate-200">
                            <!-- JS Generated Rows -->
                        </tbody>
                    </table>
                </div>
                <div class="bg-slate-50 px-6 py-3 text-xs text-slate-500 border-t border-slate-200">
                    Tip: Click on the numbers in "Current Stock" or "Threshold" to simulate inventory changes and trigger the predictive alerts.
                </div>
            </div>
        </section>

        <!-- VIEW: SHIPMENTS -->
        <section id="view-shipments" class="hidden space-y-6 max-w-7xl mx-auto">
             <!-- Intro Block -->
             <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Shipment History & Invoicing</h2>
                <p class="text-slate-600">
                    This section simulates the <code>ShipmentRepository</code> and the **Automated PDF Generation**.
                    In the Java application, clicking "Download Invoice" triggers <code>OpenPDF</code> to generate a file stream. 
                    Here, we simulate that experience by generating a print-ready invoice view on the fly.
                </p>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-slate-200">
                        <thead class="bg-slate-800 text-white">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Shipment ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Items</th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shipment-table-body" class="bg-white divide-y divide-slate-200">
                            <!-- JS Generated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- VIEW: ARCHITECTURE -->
        <section id="view-architecture" class="hidden space-y-8 max-w-5xl mx-auto">
             <!-- Intro Block -->
             <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Technical Architecture</h2>
                <p class="text-slate-600">
                    A visual breakdown of the MVC architecture and data flow implemented in the Spring Boot backend.
                </p>
            </div>

            <!-- Flow Diagram -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                <!-- User -->
                <div class="bg-indigo-50 p-6 rounded border border-indigo-200 flex flex-col items-center justify-center h-48">
                    <span class="text-4xl mb-2">üë§</span>
                    <h3 class="font-bold text-indigo-900">User / Browser</h3>
                    <p class="text-xs text-indigo-700 mt-2">Interacts with Thymeleaf Views</p>
                </div>
                
                <!-- Controller -->
                <div class="bg-blue-50 p-6 rounded border border-blue-200 flex flex-col items-center justify-center h-48 relative">
                    <span class="absolute top-1/2 -left-3 transform -translate-y-1/2 text-slate-400">‚û°</span>
                    <span class="text-4xl mb-2">üéÆ</span>
                    <h3 class="font-bold text-blue-900">Controller</h3>
                    <code class="text-xs bg-white px-2 py-1 rounded border mt-2">ScmController.java</code>
                    <p class="text-xs text-blue-700 mt-1">Routes Requests</p>
                </div>

                <!-- Service -->
                <div class="bg-emerald-50 p-6 rounded border border-emerald-200 flex flex-col items-center justify-center h-48 relative shadow-lg ring-2 ring-emerald-400 ring-opacity-50">
                    <span class="absolute top-1/2 -left-3 transform -translate-y-1/2 text-slate-400">‚û°</span>
                    <span class="text-4xl mb-2">üß†</span>
                    <h3 class="font-bold text-emerald-900">Service Layer</h3>
                    <code class="text-xs bg-white px-2 py-1 rounded border mt-2">ScmService.java</code>
                    <p class="text-xs text-emerald-700 mt-1">Predictive Logic & PDFs</p>
                    <span class="absolute -top-3 bg-emerald-500 text-white text-[10px] px-2 py-0.5 rounded-full">Core Logic</span>
                </div>

                <!-- Repo/DB -->
                <div class="bg-slate-100 p-6 rounded border border-slate-300 flex flex-col items-center justify-center h-48 relative">
                    <span class="absolute top-1/2 -left-3 transform -translate-y-1/2 text-slate-400">‚û°</span>
                    <span class="text-4xl mb-2">üíæ</span>
                    <h3 class="font-bold text-slate-900">Data Access</h3>
                    <code class="text-xs bg-white px-2 py-1 rounded border mt-2">Repositories (JPA)</code>
                    <p class="text-xs text-slate-600 mt-1">MySQL Database</p>
                </div>
            </div>

            <!-- Tech Stack Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                <div class="p-4 bg-white border rounded shadow-sm">
                    <h4 class="font-bold text-orange-600">Java 21</h4>
                    <p class="text-xs text-slate-500">Core Backend Language</p>
                </div>
                <div class="p-4 bg-white border rounded shadow-sm">
                    <h4 class="font-bold text-green-600">Spring Boot 3.4</h4>
                    <p class="text-xs text-slate-500">Application Framework</p>
                </div>
                <div class="p-4 bg-white border rounded shadow-sm">
                    <h4 class="font-bold text-blue-800">MySQL 8</h4>
                    <p class="text-xs text-slate-500">Relational Database</p>
                </div>
                <div class="p-4 bg-white border rounded shadow-sm">
                    <h4 class="font-bold text-teal-700">Thymeleaf</h4>
                    <p class="text-xs text-slate-500">Server-side Rendering</p>
                </div>
            </div>
        </section>

    </main>

    <!-- INVOICE MODAL (Hidden by default) -->
    <div id="invoice-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div id="invoice-modal" class="bg-white w-full max-w-2xl rounded shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- Modal Header -->
            <div class="bg-slate-800 text-white p-4 flex justify-between items-center print:hidden">
                <h3 class="font-bold">Invoice Preview (Simulation)</h3>
                <button onclick="closeInvoice()" class="text-slate-300 hover:text-white">‚úï</button>
            </div>
            <!-- Invoice Content (Simulating PDF) -->
            <div class="p-8 overflow-y-auto flex-1 font-serif text-slate-900" id="invoice-content">
                <div class="text-center mb-8 border-b pb-4">
                    <h1 class="text-3xl font-bold mb-2">INVOICE</h1>
                    <p class="text-sm text-slate-500" id="inv-num">#SCM-1001</p>
                </div>
                <div class="flex justify-between mb-8">
                    <div>
                        <h4 class="font-bold text-sm uppercase text-slate-500">Bill To:</h4>
                        <p class="text-lg font-semibold" id="inv-customer">Customer Name</p>
                    </div>
                    <div class="text-right">
                        <h4 class="font-bold text-sm uppercase text-slate-500">Date:</h4>
                        <p id="inv-date">2023-01-01</p>
                    </div>
                </div>
                <table class="w-full mb-8">
                    <thead>
                        <tr class="border-b-2 border-slate-800">
                            <th class="text-left py-2">Product</th>
                            <th class="text-right py-2">Price</th>
                            <th class="text-right py-2">Qty</th>
                            <th class="text-right py-2">Total</th>
                        </tr>
                    </thead>
                    <tbody id="inv-items">
                        <!-- Items go here -->
                    </tbody>
                    <tfoot>
                        <tr class="border-t-2 border-slate-800">
                            <td colspan="3" class="text-right py-4 font-bold">Grand Total:</td>
                            <td class="text-right py-4 font-bold text-xl" id="inv-total">$0.00</td>
                        </tr>
                    </tfoot>
                </table>
                <div class="text-center text-xs text-slate-400 mt-12">
                    Generated by SCM System ‚Ä¢ Enterprise Edition
                </div>
            </div>
            <!-- Modal Footer -->
            <div class="bg-slate-100 p-4 flex justify-end gap-2 print:hidden">
                <button onclick="closeInvoice()" class="px-4 py-2 text-slate-600 hover:bg-slate-200 rounded">Close</button>
                <button onclick="window.print()" class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded shadow">üñ® Print / Save as PDF</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA SIMULATION ---
        // Simulating the MySQL Database state
        let inventory = [
            { id: 1, name: "Laptop", price: 1200.00, stock: 5, threshold: 10 }, // Starting with LOW STOCK to match README
            { id: 2, name: "Mouse", price: 25.00, stock: 100, threshold: 20 },
            { id: 3, name: "Monitor", price: 300.00, stock: 15, threshold: 5 },
            { id: 4, name: "Keyboard", price: 45.00, stock: 8, threshold: 15 }
        ];

        let shipments = [
            { 
                id: 101, 
                customer: "Tech Corp Inc.", 
                date: "2023-10-25", 
                items: [
                    { productId: 1, qty: 2 },
                    { productId: 2, qty: 10 }
                ] 
            },
            { 
                id: 102, 
                customer: "Global Logistics Ltd.", 
                date: "2023-11-02", 
                items: [
                    { productId: 3, qty: 5 },
                    { productId: 4, qty: 2 }
                ] 
            }
        ];

        // --- STATE MANAGEMENT ---
        let currentView = 'dashboard';

        // --- CHART INSTANCES ---
        let stockChartInstance = null;
        let healthChartInstance = null;

        // --- CORE FUNCTIONS ---

        function init() {
            renderDashboard();
            renderShipments();
        }

        function navTo(viewId) {
            // Update UI State
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            // Update Tab Styles
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('bg-slate-800', 'border-emerald-400', 'text-emerald-400');
                el.classList.add('text-white', 'border-transparent');
            });
            const activeNav = document.getElementById(`nav-${viewId}`);
            if(activeNav) {
                activeNav.classList.add('bg-slate-800', 'border-emerald-400', 'text-emerald-400');
                activeNav.classList.remove('border-transparent', 'text-white');
            }

            currentView = viewId;
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // --- DASHBOARD LOGIC (THE PREDICTIVE TWIST) ---

        function renderDashboard() {
            const tableBody = document.getElementById('inventory-table-body');
            const alertContainer = document.getElementById('alert-container');
            const alertList = document.getElementById('alert-list');
            
            tableBody.innerHTML = '';
            alertList.innerHTML = '';
            let hasAlerts = false;

            // 1. Render Table & Check Logic
            inventory.forEach((item, index) => {
                // THE LOGIC: Checks if Stock <= Threshold
                const isLowStock = item.stock <= item.threshold;
                
                if (isLowStock) {
                    hasAlerts = true;
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="font-bold">${item.name}</span> (Current: ${item.stock}, Threshold: ${item.threshold}) - <span class="font-semibold">Restock Needed</span>`;
                    alertList.appendChild(li);
                }

                const tr = document.createElement('tr');
                tr.className = isLowStock ? "bg-red-50 hover:bg-red-100 transition" : "hover:bg-slate-50 transition";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">#${item.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">$${item.price.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">
                        <input type="number" value="${item.stock}" onchange="updateItem(${index}, 'stock', this.value)" 
                            class="w-20 border rounded px-2 py-1 focus:ring-2 focus:ring-emerald-500 ${isLowStock ? 'border-red-300 bg-red-100' : 'border-slate-300'}">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">
                        <input type="number" value="${item.threshold}" onchange="updateItem(${index}, 'threshold', this.value)" 
                            class="w-20 border rounded px-2 py-1 focus:ring-2 focus:ring-emerald-500 border-slate-300">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${isLowStock ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                            ${isLowStock ? 'Low Stock' : 'Healthy'}
                        </span>
                    </td>
                `;
                tableBody.appendChild(tr);
            });

            // 2. Toggle Alert Box
            if (hasAlerts) {
                alertContainer.classList.remove('hidden');
            } else {
                alertContainer.classList.add('hidden');
            }

            // 3. Update Charts
            updateCharts();
        }

        function updateItem(index, field, value) {
            inventory[index][field] = parseInt(value);
            renderDashboard(); // Re-run logic immediately
        }

        function updateCharts() {
            // Prepare Data
            const labels = inventory.map(i => i.name);
            const stocks = inventory.map(i => i.stock);
            const thresholds = inventory.map(i => i.threshold);
            const healthyCount = inventory.filter(i => i.stock > i.threshold).length;
            const lowStockCount = inventory.length - healthyCount;

            // Chart 1: Stock vs Threshold (Bar)
            const ctx1 = document.getElementById('stockChart').getContext('2d');
            if (stockChartInstance) stockChartInstance.destroy();
            
            stockChartInstance = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Current Stock',
                            data: stocks,
                            backgroundColor: '#10b981', // Emerald 500
                            borderRadius: 4
                        },
                        {
                            label: 'Reorder Threshold',
                            data: thresholds,
                            backgroundColor: '#ef4444', // Red 500
                            borderRadius: 4,
                            // Make it appear as a line or narrower bar
                            barPercentage: 0.5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // Chart 2: Health (Doughnut)
            const ctx2 = document.getElementById('healthChart').getContext('2d');
            if (healthChartInstance) healthChartInstance.destroy();

            healthChartInstance = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Healthy Items', 'Low Stock Items'],
                    datasets: [{
                        data: [healthyCount, lowStockCount],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // --- SHIPMENT LOGIC ---

        function renderShipments() {
            const tbody = document.getElementById('shipment-table-body');
            tbody.innerHTML = '';

            shipments.forEach(ship => {
                // Calculate Total on the fly (simulating Java method)
                let total = 0;
                let itemCount = 0;
                ship.items.forEach(item => {
                    const product = inventory.find(p => p.id === item.productId);
                    if(product) {
                        total += product.price * item.qty;
                        itemCount += item.qty;
                    }
                });

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-mono">#SCM-${ship.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-700">${ship.customer}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${ship.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${itemCount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-slate-800">$${total.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">
                        <button onclick="generateInvoice(${ship.id})" class="text-indigo-600 hover:text-indigo-900 font-medium flex items-center gap-1">
                            üìÑ Invoice
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function generateInvoice(shipmentId) {
            const ship = shipments.find(s => s.id === shipmentId);
            if(!ship) return;

            // Populate Modal Data
            document.getElementById('inv-num').textContent = `#SCM-${ship.id}`;
            document.getElementById('inv-customer').textContent = ship.customer;
            document.getElementById('inv-date').textContent = ship.date;

            const tbody = document.getElementById('inv-items');
            tbody.innerHTML = '';
            let grandTotal = 0;

            ship.items.forEach(item => {
                const product = inventory.find(p => p.id === item.productId);
                if(product) {
                    const lineTotal = product.price * item.qty;
                    grandTotal += lineTotal;
                    tbody.innerHTML += `
                        <tr class="border-b border-slate-100">
                            <td class="py-2 text-left">${product.name}</td>
                            <td class="py-2 text-right">$${product.price.toFixed(2)}</td>
                            <td class="py-2 text-right">${item.qty}</td>
                            <td class="py-2 text-right">$${lineTotal.toFixed(2)}</td>
                        </tr>
                    `;
                }
            });

            document.getElementById('inv-total').textContent = `$${grandTotal.toFixed(2)}`;

            // Show Modal
            document.getElementById('invoice-modal-overlay').classList.remove('hidden');
        }

        function closeInvoice() {
            document.getElementById('invoice-modal-overlay').classList.add('hidden');
        }

        // Initialize App
        window.onload = init;

    </script>
</body>
</html>